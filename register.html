<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</title>
  <!-- üîå Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyDvMess3yjgYLZXeSWk8hQ4tL05j34hntY",
        authDomain: "koratwalk-otp.firebaseapp.com",
        projectId: "koratwalk-otp",
        storageBucket: "koratwalk-otp.appspot.com",
        messagingSenderId: "370412914032",
        appId: "1:370412914032:web:90c80c88891c0be1d97bb5",
        measurementId: "G-P79VK05GV8"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- ‚úÖ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
</head>
<body>
  <div class="form">
    <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
    <input type="text" id="firstname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
    <input type="text" id="lastname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    <input type="tel" id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÄ‡∏ä‡πà‡∏ô +66812345678">
    
    <div id="recaptcha-container"></div>
    <button onclick="sendOTP()">‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™ OTP</button>
    
    <input type="text" id="otp" placeholder="‡∏£‡∏´‡∏±‡∏™ OTP">
    <button onclick="verifyOTP()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP</button>
  </div>

  <script>
    let confirmationResult;

    function sendOTP() {
      const phone = document.getElementById('phone').value.trim();
      if (!phone.startsWith('+66')) {
        alert('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö +66xxxxxxxxx');
        return;
      }

      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        'size': 'invisible'
      });

      firebase.auth().signInWithPhoneNumber(phone, recaptchaVerifier)
        .then(function(result) {
          confirmationResult = result;
          alert('‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™ OTP ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }).catch(function(error) {
          alert('‡∏™‡πà‡∏á OTP ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
        });
    }

    function verifyOTP() {
      const code = document.getElementById('otp').value.trim();
      confirmationResult.confirm(code).then(function(result) {
        const username = document.getElementById('username').value.trim();
        const firstname = document.getElementById('firstname').value.trim();
        const lastname = document.getElementById('lastname').value.trim();
        const phone = document.getElementById('phone').value.trim();

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á PHP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        fetch('send_otp.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, firstname, lastname, phone })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          } else {
            alert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + data.message);
          }
        });
      }).catch(function(error) {
        alert("OTP ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: " + error.message);
      });
    }
  </script>
</body>
</html>
